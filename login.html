<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chat â€” Login</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
    margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg,#071428,#0f1724);
    font-family:Inter,Arial;color:#fff;padding:16px;
}
.card{
    width:100%;max-width:420px;padding:22px;border-radius:12px;
    background:rgba(255,255,255,0.03);
}
.input{
    width:100%;padding:12px;border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    background:transparent;color:#fff;margin-bottom:10px;
}
.btn{
    width:100%;padding:12px;border-radius:10px;border:none;
    background:#7c3aed;color:#fff;font-weight:600;cursor:pointer;
}
.small{color:#9aa8bb;text-align:center;margin-top:10px}
.link{color:#9bd;cursor:pointer;text-decoration:underline}
.error{color:#ff6b6b;margin:8px 0;font-size:13px;display:none}

/* continue with google button */
.google-btn {
  width: 100%;
  background: white;
  color: #444;
  border: 1px solid #ccc;
  padding: 12px;
  border-radius: 8px;
  font-size: 15px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 15px;
  transition: 0.2s;
}

.google-btn:hover {
  background: #f2f2f2;
}

.google-icon {
  width: 20px;
  height: 20px;
}

</style>


</head>

<body>
<div class="card">
  <h1 style="margin:0 0 10px">Welcome back</h1>

  <input id="email" class="input" placeholder="Email" type="email" />
  <input id="password" class="input" placeholder="Password" type="password" />

  <div id="error" class="error"></div>

  <button id="btnLogin" class="btn">Log in</button>
  <!-- Continue writh gmail -->
  <button id="googleSignIn" class="google-btn">
  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon">
  Continue with Google
</button>

  <div class="small">
    Forgot your password? 
    <span id="forgotLink" class="link">Reset here</span>
  </div>

  <div class="small">No account?  
     <span class="link" onclick="location.href='signup.html'">Create one</span>
  </div>

</div>

<!-- Firebase COMPAT SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>

<!-- Firebase Config -->
<script>
const firebaseConfig = {
    apiKey: "AIzaSyBdhQFVF0PTZMw0DXT5zBLpxndw_HNSv5U",
    authDomain: "gatochat-56ab6.firebaseapp.com",
    databaseURL: "https://gatochat-56ab6-default-rtdb.firebaseio.com",
    projectId: "gatochat-56ab6",
    storageBucket: "gatochat-56ab6.firebasestorage.app",
    messagingSenderId: "888124564246",
    appId: "1:888124564246:web:33a41ee68eec0f6b9c2637"
};

if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.database();
</script>

<!-- Login Logic -->
<script>
const errEl = document.getElementById("error");

// Login button
document.getElementById("btnLogin").addEventListener("click", async () => {
    errEl.style.display = "none";

    const email = document.getElementById("email").value.trim();
    const pass  = document.getElementById("password").value;

    if (!email || !pass) {
        errEl.innerText = "Enter email & password";
        errEl.style.display = "block";
        return;
    }

    try {
        const userCred = await auth.signInWithEmailAndPassword(email, pass);
        const user = userCred.user;

        // Save last login time
        await db.ref("users/" + user.uid + "/lastLogin").set(Date.now());

        location.href = "members.html";

    } catch (e) {
        errEl.innerText = e.message;
        errEl.style.display = "block";
    }
});

// Forgot password link
document.getElementById("forgotLink").addEventListener("click", async () => {
    errEl.style.display = "none";
    const email = document.getElementById("email").value.trim();

    if (!email) {
        errEl.innerText = "Enter your email to reset password";
        errEl.style.display = "block";
        return;
    }

    try {
        await auth.sendPasswordResetEmail(email);
        errEl.style.color = "#6bff6b";
        errEl.innerText = "Password reset email sent! Check your inbox.";
        errEl.style.display = "block";
    } catch (e) {
        errEl.style.color = "#ff6b6b";
        errEl.innerText = e.message;
        errEl.style.display = "block";
    }
});
</script>
<script>
const provider = new firebase.auth.GoogleAuthProvider();

// Force popup + always ask user to choose account
provider.setCustomParameters({ prompt: "select_account" });

document.getElementById("googleSignIn").onclick = async () => {
    try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;

        // If Google does not give photo, use fallback avatar
        const finalPhoto = user.photoURL 
            ? user.photoURL 
            : "https://i.ibb.co/2k0Q6fB/default-user.png"; // your fallback SVG or PNG

        // Save/update user in database
        const userRef = db.ref("users/" + user.uid);

        await userRef.update({
            name: user.displayName || "Unknown User",
            email: user.email,
            photo: finalPhoto,
            uid: user.uid,
            provider: "google",
            lastLogin: Date.now()
        });

        // Redirect
        location.href = "members.html";

    } catch (err) {
        alert(err.message);
    }
};
</script>


</body>
</html>
